version: '3.8'

services:
  # Next.js Frontend
  web:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ./src:/app/src
      - ./public:/app/public
    environment:
      - NEXT_PUBLIC_API_URL=http://python-api:8000
    depends_on:
      - python-api
    networks:
      - crypto-analytics

  # Python Backend API
  python-api:
    build:
      context: ./python
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ./python/src:/app/src
      - ./public/data:/app/data  # Share data folder
    environment:
      - API_PORT=8000
      - API_RELOAD=true
      - CORS_ORIGINS=http://localhost:3000
      - DATA_DIR=/app/data
    networks:
      - crypto-analytics
    command: poetry run uvicorn src.api.main:app --host 0.0.0.0 --port 8000 --reload

networks:
  crypto-analytics:
    driver: bridge
